# Laravel学習用掲示板アプリ - 実装計画書

## フェーズ構成

- **Phase 1: Walking Skeleton**: プロジェクトの基盤構築とデプロイ可能な最小構成 / #1-#8
- **Phase 2: Core Features**: 掲示板の基本機能（スレッド・投稿のCRUD） / #9-#16
- **Phase 3: Enhancement**: ユーザー体験向上（検索・フィルター・画像） / #17-#23
- **Phase 4: Polish**: 品質向上とセキュリティ強化 / #24-#28

## 依存関係マップ

```
#1 → #2 → #3 → #4 → #5
              ↓
         #6 → #7 → #8
              ↓
         #9 → #10 → #11
              ↓
        #12 → #13 → #14
              ↓
        #15 → #16
              ↓
        #17 → #18 → #19
              ↓
        #20 → #21
              ↓
        #22 → #23
              ↓
        #24 → #25 → #26
              ↓
        #27 → #28
```

## Issueアウトライン表

### Phase 1: Walking Skeleton

#### Issue #1: Laravel Sailプロジェクト初期設定
**概要**: Laravel Sailを使用してDockerベースの開発環境を構築する
**依存**: -
**ラベル**: infra, setup
**受け入れ基準（AC）**:
- [ ] Laravel 11.xの新規プロジェクト作成完了
- [ ] Laravel Sailのインストールと設定完了
- [ ] MySQL/Redis/MailHogコンテナが正常起動
- [ ] .env.exampleファイルの作成と基本設定記載
- [ ] sail up -dコマンドでアプリケーションが起動

#### Issue #2: Vite + Tailwind CSS + Alpine.js設定
**概要**: フロントエンドのビルド環境とCSSフレームワークを設定する
**依存**: #1
**ラベル**: frontend, setup
**受け入れ基準（AC）**:
- [ ] Vite設定ファイル（vite.config.js）の作成
- [ ] Tailwind CSS 3.xのインストールと設定
- [ ] Alpine.js 3.xの導入
- [ ] npm run devでホットリロードが動作
- [ ] 基本レイアウトファイル（app.blade.php）の作成

#### Issue #3: Laravel Breeze認証システム導入
**概要**: メール認証付きの認証システムを実装する
**依存**: #2
**ラベル**: backend, auth
**受け入れ基準（AC）**:
- [ ] Laravel Breezeのインストール完了
- [ ] ログイン/登録/パスワードリセット画面が動作
- [ ] メール認証機能の有効化
- [ ] 日本語化対応（バリデーションメッセージ等）
- [ ] MailHogでメール送信確認

#### Issue #4: データベース設計とマイグレーション作成
**概要**: 基本テーブル（users、categories、threads、posts）のマイグレーションを作成する
**依存**: #3
**ラベル**: backend, database
**受け入れ基準（AC）**:
- [ ] usersテーブルの拡張（avatar、bio、is_admin、banned_until）
- [ ] categoriesテーブルのマイグレーション作成
- [ ] threadsテーブルのマイグレーション作成
- [ ] postsテーブルのマイグレーション作成
- [ ] 外部キー制約とインデックスの設定

#### Issue #5: Eloquentモデルとリレーション設定
**概要**: 各テーブルのモデルクラスとリレーションを定義する
**依存**: #4
**ラベル**: backend, model
**受け入れ基準（AC）**:
- [ ] User、Category、Thread、Postモデルの作成
- [ ] hasMany/belongsToリレーションの設定
- [ ] fillable/castsプロパティの定義
- [ ] ローカルスコープの実装（published、latestなど）
- [ ] Factoryクラスの作成

#### Issue #6: シーダーとテストデータ作成
**概要**: 開発用のダミーデータを生成するシーダーを作成する
**依存**: #5
**ラベル**: backend, database
**受け入れ基準（AC）**:
- [ ] CategorySeederの作成（5〜10カテゴリー）
- [ ] UserSeederの作成（管理者含む20ユーザー）
- [ ] ThreadSeederの作成（50スレッド）
- [ ] PostSeederの作成（各スレッドに5〜20投稿）
- [ ] DatabaseSeederでの実行順序設定

#### Issue #7: 基本レイアウトとコンポーネント作成
**概要**: Bladeレイアウトとナビゲーション等の共通コンポーネントを作成する
**依存**: #6
**ラベル**: frontend, ui
**受け入れ基準（AC）**:
- [ ] layouts/app.blade.phpのレスポンシブ対応
- [ ] ヘッダーナビゲーションコンポーネント作成
- [ ] フッターコンポーネント作成
- [ ] フラッシュメッセージ表示コンポーネント作成
- [ ] エラーページ（404、500）の作成

#### Issue #8: ルーティング設計と基本コントローラー作成
**概要**: ルート定義と各リソースの基本コントローラーを作成する
**依存**: #7
**ラベル**: backend, routing
**受け入れ基準（AC）**:
- [ ] web.phpでのルートグループ設定（auth、guest）
- [ ] ThreadController（index、show）の作成
- [ ] HomeControllerの作成
- [ ] ルート名の設定（threads.index等）
- [ ] ミドルウェアの適用（auth、verified）

### Phase 2: Core Features

#### Issue #9: スレッド一覧表示機能
**概要**: トップページとスレッド一覧ページを実装する
**依存**: #8
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ThreadController@indexの実装（Eager Loading使用）
- [ ] threads/index.blade.phpの作成
- [ ] ページネーション実装（20件/ページ）
- [ ] カテゴリー名、投稿者、最終投稿日時の表示
- [ ] レスポンシブ対応のカード型UI

#### Issue #10: スレッド詳細表示機能
**概要**: スレッドの詳細と投稿一覧を表示する機能を実装する
**依存**: #9
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ThreadController@showの実装
- [ ] threads/show.blade.phpの作成
- [ ] 投稿一覧のページネーション（20件/ページ）
- [ ] 閲覧数カウントアップ機能
- [ ] Markdown表示対応（CommonMark使用）

#### Issue #11: スレッド作成機能
**概要**: 認証ユーザーがスレッドを作成する機能を実装する
**依存**: #10
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ThreadController@create/storeの実装
- [ ] StoreThreadRequestクラスの作成（バリデーション）
- [ ] threads/create.blade.phpの作成
- [ ] カテゴリー選択ドロップダウン
- [ ] 作成後はスレッド詳細へリダイレクト

#### Issue #12: 投稿（レス）機能実装
**概要**: スレッドへの返信投稿機能を実装する
**依存**: #11
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] PostController@storeの実装
- [ ] StorePostRequestクラスの作成
- [ ] 投稿フォームコンポーネントの作成
- [ ] Ajax投稿対応（Alpine.js使用）
- [ ] 投稿後の自動スクロール

#### Issue #13: 投稿への返信（アンカー）機能
**概要**: 特定の投稿への返信とアンカーリンク機能を実装する
**依存**: #12
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] reply_to_id の処理実装
- [ ] >>番号 形式のアンカー自動リンク化
- [ ] 返信元の投稿表示UI
- [ ] 返信ボタンクリックでフォーム自動入力
- [ ] アンカークリックでスクロール移動

#### Issue #14: スレッド・投稿の編集機能
**概要**: 自分が作成したスレッド・投稿の編集機能を実装する
**依存**: #13
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ThreadController@edit/updateの実装
- [ ] PostController@updateの実装
- [ ] ThreadPolicyの作成と適用
- [ ] 編集履歴の記録（is_edited、edited_at）
- [ ] 編集フォームのモーダル表示

#### Issue #15: スレッド・投稿の削除機能
**概要**: 論理削除を使用した削除機能を実装する
**依存**: #14
**ラベル**: backend, security
**受け入れ基準（AC）**:
- [ ] ThreadController@destroyの実装
- [ ] PostController@destroyの実装
- [ ] 削除確認ダイアログの実装
- [ ] カスケード削除の動作確認
- [ ] 削除済み表示の実装

#### Issue #16: カテゴリー別表示機能
**概要**: カテゴリーでフィルタリングしたスレッド一覧を表示する
**依存**: #15
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] CategoryControllerの作成
- [ ] カテゴリー別ルートの設定
- [ ] サイドバーにカテゴリー一覧表示
- [ ] アクティブカテゴリーのハイライト
- [ ] カテゴリー別の投稿数表示

### Phase 3: Enhancement

#### Issue #17: 検索機能実装
**概要**: スレッドタイトルと本文の全文検索機能を実装する
**依存**: #16
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] SearchControllerの作成
- [ ] MySQLのFULLTEXTインデックス使用
- [ ] 検索フォームコンポーネント作成
- [ ] 検索結果のハイライト表示
- [ ] 検索結果のページネーション

#### Issue #18: ソート機能実装
**概要**: スレッド一覧のソート機能を実装する
**依存**: #17
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] 新着順/更新順/人気順のソート実装
- [ ] URLパラメーターでのソート保持
- [ ] ソート選択UIの実装
- [ ] Ajaxでのソート切り替え
- [ ] デフォルトソート順の設定

#### Issue #19: フィルター機能実装
**概要**: 期間指定やステータスでのフィルター機能を追加する
**依存**: #18
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] 期間指定フィルター（今日/今週/今月）
- [ ] 未読/既読フィルター（将来拡張用）
- [ ] 複数フィルターの組み合わせ対応
- [ ] フィルターリセット機能
- [ ] フィルター状態のURL保持

#### Issue #20: 画像アップロード機能（基本）
**概要**: スレッドへの画像添付機能を実装する
**依存**: #19
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] thread_imagesテーブルのマイグレーション
- [ ] ImageServiceクラスの作成
- [ ] 画像アップロードフォームUI
- [ ] 最大3枚制限の実装
- [ ] 画像の保存とDB登録

#### Issue #21: 画像処理とサムネイル生成
**概要**: アップロード画像のリサイズとサムネイル生成を実装する
**依存**: #20
**ラベル**: backend, performance
**受け入れ基準（AC）**:
- [ ] Intervention Imageの導入
- [ ] 画像リサイズ処理（最大1920px）
- [ ] サムネイル生成（300x300）
- [ ] MIME type検証（JPEG/PNG/GIF）
- [ ] ファイルサイズ制限（5MB）

#### Issue #22: ユーザープロフィール機能
**概要**: ユーザーのプロフィールページと編集機能を実装する
**依存**: #21
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ProfileControllerの作成
- [ ] プロフィール表示ページ作成
- [ ] アバター画像アップロード機能
- [ ] 自己紹介文の編集機能
- [ ] 投稿履歴の表示

#### Issue #23: ユーザー投稿履歴表示
**概要**: ユーザーが作成したスレッド・投稿の一覧を表示する
**依存**: #22
**ラベル**: backend, frontend
**受け入れ基準（AC）**:
- [ ] ユーザーのスレッド一覧表示
- [ ] ユーザーの投稿一覧表示
- [ ] タブ切り替えUI実装
- [ ] 各一覧のページネーション
- [ ] プライバシー設定考慮

### Phase 4: Polish

#### Issue #24: バリデーション強化とセキュリティ
**概要**: XSS対策やCSRF対策などセキュリティを強化する
**依存**: #23
**ラベル**: backend, security
**受け入れ基準（AC）**:
- [ ] HTMLPurifierの導入と設定
- [ ] 全フォームのCSRFトークン確認
- [ ] XSS脆弱性のテストと対策
- [ ] SQL Injection対策の確認
- [ ] Mass Assignment脆弱性の確認

#### Issue #25: エラーハンドリングとログ
**概要**: 例外処理とエラーログの仕組みを整備する
**依存**: #24
**ラベル**: backend, monitoring
**受け入れ基準（AC）**:
- [ ] カスタム例外クラスの作成
- [ ] エラーページのカスタマイズ
- [ ] ログローテーション設定
- [ ] 重要操作のログ記録
- [ ] エラー通知設定（管理者向け）

#### Issue #26: パフォーマンス最適化
**概要**: N+1問題の解決とクエリ最適化を行う
**依存**: #25
**ラベル**: backend, performance
**受け入れ基準（AC）**:
- [ ] Laravel Debugbarでのクエリ確認
- [ ] Eager Loadingの適用確認
- [ ] クエリのインデックス最適化
- [ ] ビューキャッシュの設定
- [ ] 設定キャッシュの活用

#### Issue #27: レート制限実装
**概要**: スパム対策のためのレート制限を実装する
**依存**: #26
**ラベル**: backend, security
**受け入れ基準（AC）**:
- [ ] ログイン試行回数制限（5回/分）
- [ ] 投稿頻度制限（5投稿/分）
- [ ] API呼び出し制限（60回/分）
- [ ] 制限時のエラーメッセージ表示
- [ ] IPベースの制限実装

#### Issue #28: 管理者機能（基本）
**概要**: 管理者用ダッシュボードとユーザー管理機能を実装する
**依存**: #27
**ラベル**: backend, admin
**受け入れ基準（AC）**:
- [ ] AdminMiddlewareの作成
- [ ] 管理者ダッシュボード画面作成
- [ ] ユーザー一覧・検索機能
- [ ] ユーザーBAN機能実装
- [ ] 不適切投稿の削除機能

## 要確認事項

- Redisの使用開始時期（キャッシュ、セッション管理）
- 管理画面のUIフレームワーク選定（独自実装 or 既存パッケージ）
- 画像ストレージの選択（ローカル or S3互換）
- デプロイ環境の想定（VPS、AWS、その他）
- テストコードの実装範囲とカバレッジ目標